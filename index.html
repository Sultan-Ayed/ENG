<!DOCTYPE html>
<html lang="ar" dir="rtl">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>Shadow English â€” Ø§Ù„ØªØ±Ø¬Ù…Ø© Ø§Ù„Ù…Ø²Ø¯ÙˆØ¬Ø©</title>
<link href="https://fonts.googleapis.com/css2?family=Tajawal:wght@400;700;900&family=Space+Mono:wght@400;700&display=swap" rel="stylesheet">
<style>
  :root {
    --bg: #0a0e1a; --card: #1a2235; --accent: #00d4aa;
    --gold: #ffd93d; --text: #e8eaf0; --muted: #6b7a99; --border: #2a3550;
  }
  * { margin:0; padding:0; box-sizing:border-box; }
  body { background:var(--bg); color:var(--text); font-family:'Tajawal',sans-serif; min-height:100vh; overflow-x:hidden; }
  
  /* Ø¥Ø®ÙØ§Ø¡ Ø´Ø±ÙŠØ· Ø¬ÙˆØ¬Ù„ Ø§Ù„Ø¹Ù„ÙˆÙŠ */
  #google_translate_element { display: none !important; }
  .goog-te-banner-frame.skiptranslate { display: none !important; }
  body { top: 0px !important; }

  .wrap { max-width:960px; margin:0 auto; padding:2rem 1.5rem; position:relative; z-index:1; }

  /* Header */
  .header { text-align:center; margin-bottom:2.5rem; }
  .badge { display:inline-block; background:rgba(0,212,170,.12); border:1px solid rgba(0,212,170,.35); color:var(--accent); font-size:.72rem; letter-spacing:3px; text-transform:uppercase; padding:.35rem 1.1rem; border-radius:100px; margin-bottom:.9rem; font-family:'Space Mono',monospace; }
  .header h1 { font-size:clamp(2rem,5vw,3rem); font-weight:900; line-height:1.1; color: #fff; }
  .header h1 span { color:var(--accent); }

  /* Card */
  .card { background:var(--card); border:1px solid var(--border); border-radius:20px; margin-bottom:1.5rem; overflow:hidden; }
  .card-head { padding:.9rem 1.4rem; border-bottom:1px solid var(--border); background:rgba(0,0,0,.18); display:flex; align-items:center; justify-content:space-between; }
  .card-title { font-size:.8rem; color:var(--muted); letter-spacing:2px; text-transform:uppercase; font-family:'Space Mono',monospace; }
  
  /* Inputs */
  .url-input, .tr-input { background:var(--bg); border:2px solid var(--border); border-radius:12px; padding:.85rem 1.1rem; color:var(--text); width:100%; outline:none; font-family:'Space Mono',monospace; direction:ltr; }
  .tr-input { margin-top: 1rem; min-height:150px; }

  /* Buttons */
  .btn { background:var(--accent); color:#000; border:none; border-radius:12px; padding:.85rem 1.7rem; font-size:.93rem; font-weight:700; cursor:pointer; }
  .btn-sm { background:var(--accent); color:#000; border:none; border-radius:9px; padding:.4rem 1rem; font-size:.82rem; font-weight:700; cursor:pointer; }

  /* Video Wrap */
  .video-wrap { position:relative; width:100%; padding-top:56.25%; background:#000; }
  .video-wrap iframe { position:absolute; inset:0; width:100%; height:100%; border:none; }

  /* Transcript Style - Dual Language */
  .tr-body { padding:.9rem; max-height:500px; overflow-y:auto; }
  .t-line { display:flex; gap:.7rem; padding:1rem; border-radius:11px; cursor:pointer; margin-bottom:.5rem; border:1px solid transparent; align-items:flex-start; transition: 0.2s; }
  .t-line:hover { background:rgba(255,255,255,0.03); }
  .t-line.active { background:rgba(0,212,170,0.1); border-color:rgba(0,212,170,0.3); }

  .t-time { font-size:.75rem; color:var(--accent); font-family:'Space Mono',monospace; min-width:45px; }
  .content-box { flex: 1; display: flex; flex-direction: column; gap: 5px; }
  
  /* Ø§Ù„Ù†Øµ Ø§Ù„Ø¥Ù†Ø¬Ù„ÙŠØ²ÙŠ - ÙŠØ¨Ù‚Ù‰ Ø¯Ø§Ø¦Ù…Ø§Ù‹ ÙÙŠ Ø§Ù„Ø£Ø¹Ù„Ù‰ */
  .t-en { font-size:1.05rem; color: #fff; font-family:'Space Mono',monospace; direction:ltr; text-align:left; font-weight: 500; }
  
  /* Ø§Ù„Ù†Øµ Ø§Ù„Ø¹Ø±Ø¨ÙŠ - ÙŠØ¸Ù‡Ø± ØªØ­Øª Ø§Ù„Ø¥Ù†Ø¬Ù„ÙŠØ²ÙŠ Ø¨Ù„ÙˆÙ† Ù‡Ø§Ø¯Ø¦ */
  .t-ar { font-size:.95rem; color:var(--muted); direction:rtl; text-align:right; display:none; padding-top: 4px; border-top: 1px solid rgba(255,255,255,0.05); }
  
  .show-ar .t-ar { display:block; }

  .rep-btn { background:none; border:1px solid var(--border); color:var(--muted); border-radius:7px; width:30px; height:30px; cursor:pointer; display:flex; align-items:center; justify-content:center; }
  .rep-btn.on { border-color:var(--gold); color:var(--gold); background:rgba(255,217,61,.1); }

  .hidden { display:none; }
</style>
</head>
<body>

<div id="google_translate_element"></div>

<div class="wrap">
  <div class="header">
    <div class="badge">ğŸ§ Shadowing Method</div>
    <h1>ØªØ¹Ù„Ù… Ø§Ù„Ø¥Ù†Ø¬Ù„ÙŠØ²ÙŠØ©<br><span>Ø¨Ø§Ù„Ø´Ø§Ø¯ÙˆÙŠÙ†Ø¬</span></h1>
  </div>

  <div id="setupSection">
    <div class="card">
      <div class="card-head"><span class="card-title">ğŸ“º Ø¥Ø¹Ø¯Ø§Ø¯ Ø§Ù„Ø¬Ù„Ø³Ø©</span></div>
      <div class="card-body" style="padding:1.3rem;">
        <input type="text" class="url-input" id="videoUrl" placeholder="Ø£Ø¯Ø®Ù„ Ø±Ø§Ø¨Ø· Ø§Ù„ÙŠÙˆØªÙŠÙˆØ¨...">
        <textarea class="tr-input" id="trInput" placeholder="Ø£Ø¯Ø®Ù„ Ø§Ù„Ù†Øµ (Transcript) Ù‡Ù†Ø§..."></textarea>
        <div style="margin-top:1.5rem; text-align:left;">
          <button class="btn" onclick="startSession()">Ø§Ø¨Ø¯Ø£ Ø§Ù„Ø¢Ù† â–¶</button>
        </div>
      </div>
    </div>
  </div>

  <div id="playerSection" class="hidden">
    <div class="card">
      <div class="video-wrap"><div id="ytContainer"></div></div>
    </div>

    <div class="card">
      <div class="card-head">
        <span class="card-title">ğŸ“„ Ø§Ù„Ù†Øµ ÙˆØ§Ù„ØªØ±Ø¬Ù…Ø©</span>
        <button class="btn-sm" id="trBtn" onclick="toggleTranslation()">ğŸŒ ØªØ±Ø¬Ù… Ù„Ù„Ø¹Ø±Ø¨ÙŠØ©</button>
      </div>
      <div class="tr-body" id="trBody"></div>
    </div>
  </div>
</div>

<script type="text/javascript">
function googleTranslateElementInit() {
  new google.translate.TranslateElement({pageLanguage: 'en', includedLanguages: 'ar', autoDisplay: false}, 'google_translate_element');
}
</script>
<script type="text/javascript" src="//translate.google.com/translate_a/element.js?cb=googleTranslateElementInit"></script>

<script>
let player, lines = [], loopIdx = null;

function getYTId(url) {
  const m = url.match(/(?:youtube\.com\/(?:watch\?(?:.*&)?v=|shorts\/|embed\/)|youtu\.be\/)([a-zA-Z0-9_-]{11})/);
  return m ? m[1] : null;
}

function parseTranscript(raw) {
  const rows = raw.split('\n').map(r=>r.trim()).filter(Boolean);
  const timeRE = /^(\d{1,2}):(\d{2})(?::(\d{2}))?$/;
  const result = [];
  let i = 0;
  while (i < rows.length) {
    const tm = rows[i].match(timeRE);
    if (tm) {
      const secs = tm[3]!==undefined ? +tm[1]*3600+ +tm[2]*60+ +tm[3] : +tm[1]*60+ +tm[2];
      let parts=[]; i++;
      while (i<rows.length && !rows[i].match(timeRE)) { parts.push(rows[i]); i++; }
      result.push({time:secs, en:parts.join(' ').trim()});
    } else {
      const inl = rows[i].match(/^(\d{1,2}):(\d{2})(?::(\d{2}))?\s+(.+)$/);
      if (inl) {
        const secs = inl[3]!==undefined ? +inl[1]*3600+ +inl[2]*60+ +inl[3] : +inl[1]*60+ +inl[2];
        result.push({time:secs, en:inl[4].trim()});
      }
      i++;
    }
  }
  return result;
}

function startSession() {
  const url = document.getElementById('videoUrl').value;
  const raw = document.getElementById('trInput').value;
  const ytId = getYTId(url);
  if (!ytId || !raw) return alert("Ø§Ù„Ø±Ø¬Ø§Ø¡ ØªØ¹Ø¨Ø¦Ø© Ø§Ù„Ø±Ø§Ø¨Ø· ÙˆØ§Ù„Ù†Øµ");
  lines = parseTranscript(raw);
  document.getElementById('setupSection').className = 'hidden';
  document.getElementById('playerSection').className = '';
  renderLines();
  loadYT(ytId);
}

function loadYT(id) {
  const s = document.createElement('script');
  s.src = "https://www.youtube.com/iframe_api";
  document.head.appendChild(s);
  window.onYouTubeIframeAPIReady = () => {
    player = new YT.Player('ytContainer', {
      videoId: id,
      events: { onReady: () => {
        setInterval(() => {
          const t = player.getCurrentTime();
          let ai = 0;
          lines.forEach((l, i) => { if (t >= l.time) ai = i; });
          document.querySelectorAll('.t-line').forEach((el, i) => el.classList.toggle('active', i === ai));
          if (loopIdx !== null) {
            const end = lines[loopIdx+1] ? lines[loopIdx+1].time : lines[loopIdx].time + 5;
            if (t >= end) player.seekTo(lines[loopIdx].time);
          }
        }, 400);
      }}
    });
  };
}

// Ø§Ù„ÙˆØ¸ÙŠÙØ© Ø§Ù„Ø£Ø³Ø§Ø³ÙŠØ©: ØªØ±Ø¬Ù…Ø© Ù…Ø¹ Ø§Ù„Ø­ÙØ§Ø¸ Ø¹Ù„Ù‰ Ø§Ù„Ù†Øµ Ø§Ù„Ø£ØµÙ„ÙŠ
function toggleTranslation() {
  const trBody = document.getElementById('trBody');
  const btn = document.getElementById('trBtn');
  
  if (trBody.classList.contains('show-ar')) {
    trBody.classList.remove('show-ar');
    btn.textContent = "ğŸŒ ØªØ±Ø¬Ù… Ù„Ù„Ø¹Ø±Ø¨ÙŠØ©";
  } else {
    // ØªÙØ¹ÙŠÙ„ Ø¬ÙˆØ¬Ù„
    const combo = document.querySelector('.goog-te-combo');
    if (combo) { combo.value = 'ar'; combo.dispatchEvent(new Event('change')); }
    
    // ÙˆØ¶Ø¹ Ø§Ù„Ù†Øµ Ø§Ù„Ø¥Ù†Ø¬Ù„ÙŠØ²ÙŠ ÙÙŠ Ø®Ø§Ù†Ø© Ø§Ù„Ø¹Ø±Ø¨ÙŠ Ù„ÙŠØªÙ… ØªØ±Ø¬Ù…ØªÙ‡ ØªÙ„Ù‚Ø§Ø¦ÙŠØ§Ù‹ Ø¨ÙˆØ§Ø³Ø·Ø© Ø¬ÙˆØ¬Ù„
    lines.forEach((l, i) => {
      const arEl = document.getElementById(`ar-${i}`);
      if (arEl) arEl.textContent = l.en;
    });
    
    trBody.classList.add('show-ar');
    btn.textContent = "ğŸ“„ Ø¥Ø®ÙØ§Ø¡ Ø§Ù„ØªØ±Ø¬Ù…Ø©";
  }
}

function renderLines() {
  const body = document.getElementById('trBody');
  body.innerHTML = lines.map((l, i) => `
    <div class="t-line" onclick="player.seekTo(${l.time})">
      <span class="t-time">${Math.floor(l.time/60)}:${Math.floor(l.time%60).toString().padStart(2,'0')}</span>
      <div class="content-box">
        <div class="t-en">${l.en}</div>
        <div class="t-ar" id="ar-${i}"></div>
      </div>
      <button class="rep-btn" onclick="event.stopPropagation(); loopIdx=(loopIdx===${i}?null:${i}); this.classList.toggle('on')">ğŸ”</button>
    </div>
  `).join('');
}
</script>
</body>
</html>
