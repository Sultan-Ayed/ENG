<!DOCTYPE html>
<html lang="ar" dir="rtl">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>Shadow English â€” ØªØ¹Ù„Ù… Ø¨Ø§Ù„Ø´Ø§Ø¯ÙˆÙŠÙ†Ø¬</title>
<link href="https://fonts.googleapis.com/css2?family=Tajawal:wght@400;700;900&family=Space+Mono:wght@400;700&display=swap" rel="stylesheet">
<style>
  :root {
    --bg: #0a0e1a; --card: #1a2235; --accent: #00d4aa;
    --gold: #ffd93d; --text: #e8eaf0; --muted: #6b7a99; --border: #2a3550;
  }
  * { margin:0; padding:0; box-sizing:border-box; }
  body { background:var(--bg); color:var(--text); font-family:'Tajawal',sans-serif; min-height:100vh; overflow-x:hidden; }
  body::before { content:''; position:fixed; inset:0; background:radial-gradient(ellipse 600px 400px at 80% 20%,rgba(0,212,170,.07) 0%,transparent 70%),radial-gradient(ellipse 500px 300px at 10% 80%,rgba(255,107,107,.05) 0%,transparent 70%); pointer-events:none; z-index:0; }

  /* ØªÙ†Ø³ÙŠÙ‚ Ù…Ø­Ø±Ùƒ Ø¬ÙˆØ¬Ù„ Ù„ÙŠØ¨Ù‚Ù‰ Ù…Ø®ÙÙŠØ§Ù‹ ÙˆÙŠØ¹Ù…Ù„ ÙÙŠ Ø§Ù„Ø®Ù„ÙÙŠØ© */
  #google_translate_element { display: none !important; }
  .goog-te-banner-frame.skiptranslate { display: none !important; }
  body { top: 0px !important; }

  .wrap { max-width:960px; margin:0 auto; padding:2rem 1.5rem; position:relative; z-index:1; }

  /* Header */
  .header { text-align:center; margin-bottom:2.5rem; animation:fadeDown .7s ease; }
  .badge { display:inline-block; background:rgba(0,212,170,.12); border:1px solid rgba(0,212,170,.35); color:var(--accent); font-size:.72rem; letter-spacing:3px; text-transform:uppercase; padding:.35rem 1.1rem; border-radius:100px; margin-bottom:.9rem; font-family:'Space Mono',monospace; }
  .header h1 { font-size:clamp(2rem,5vw,3rem); font-weight:900; line-height:1.1; }
  .header h1 span { color:var(--accent); }
  .header p { color:var(--muted); font-size:1rem; margin-top:.5rem; }
  .dedication { display:inline-flex; align-items:center; gap:.6rem; margin-top:1.2rem; background:rgba(0,212,170,.06); border:1px solid rgba(0,212,170,.2); border-radius:100px; padding:.5rem 1.2rem; flex-wrap:wrap; justify-content:center; }
  .ded-name  { font-size:.95rem; font-weight:700; }
  .ded-link  { font-size:.82rem; color:var(--accent); text-decoration:none; border:1px solid rgba(0,212,170,.35); border-radius:100px; padding:.2rem .8rem; font-family:'Space Mono',monospace; }

  /* Card & Layout */
  .card { background:var(--card); border:1px solid var(--border); border-radius:20px; margin-bottom:1.5rem; overflow:hidden; animation:fadeUp .6s ease .2s both; }
  .card-head { padding:.9rem 1.4rem; border-bottom:1px solid var(--border); background:rgba(0,0,0,.18); display:flex; align-items:center; justify-content:space-between; flex-wrap:wrap; gap:.8rem; }
  .card-title { font-size:.8rem; color:var(--muted); letter-spacing:2px; text-transform:uppercase; font-family:'Space Mono',monospace; }
  .card-body  { padding:1.3rem; }

  /* Buttons */
  .btn { background:var(--accent); color:#000; border:none; border-radius:12px; padding:.85rem 1.7rem; font-size:.93rem; font-weight:700; cursor:pointer; transition:all .18s; }
  .btn:hover { background:#00f0c0; transform:translateY(-2px); box-shadow:0 8px 24px rgba(0,212,170,.35); }
  .btn-sm { background:var(--accent); color:#000; border:none; border-radius:9px; padding:.4rem 1rem; font-size:.82rem; font-weight:700; cursor:pointer; }
  .btn-outline { background:transparent; color:var(--accent); border:1px solid var(--accent); border-radius:12px; padding:.85rem 1.7rem; font-size:.93rem; font-weight:700; cursor:pointer; }

  /* Inputs */
  .url-input, .tr-input {
    background:var(--bg); border:2px solid var(--border); border-radius:12px; padding:.85rem 1.1rem; color:var(--text); outline:none; font-family:'Space Mono',monospace; direction:ltr; width:100%;
  }
  .tr-input { resize:vertical; min-height:160px; margin-top: 1rem; }

  /* Player & Controls */
  .video-wrap { position:relative; width:100%; padding-top:56.25%; background:#000; }
  .video-wrap iframe { position:absolute; inset:0; width:100%; height:100%; border:none; }
  .controls-bar { padding:.9rem 1.4rem; display:flex; align-items:center; gap:1.3rem; flex-wrap:wrap; border-top:1px solid var(--border); background:rgba(0,0,0,.18); }
  
  .speed-btn { background:var(--bg); border:1px solid var(--border); color:var(--text); border-radius:8px; padding:.3rem .65rem; font-size:.78rem; cursor:pointer; }
  .speed-btn.active { background:var(--accent); color:#000; font-weight:700; }

  /* Transcript Lines */
  .tr-body { padding:.9rem; max-height:440px; overflow-y:auto; }
  .t-line { display:flex; gap:.7rem; padding:.75rem .85rem; border-radius:11px; cursor:pointer; margin-bottom:.18rem; border:1px solid transparent; align-items:flex-start; }
  .t-line:hover { background:rgba(0,212,170,.05); }
  .t-line.active { background:rgba(0,212,170,.11); border-color:rgba(0,212,170,.42); }

  .t-time { font-size:.7rem; color:var(--accent); font-family:'Space Mono',monospace; min-width:40px; margin-top:3px; }
  .t-en { font-size:.94rem; color:var(--text); line-height:1.55; direction:ltr; text-align:left; flex: 1; }
  .t-ar { font-size:.88rem; color:var(--muted); margin-top:.28rem; direction:rtl; text-align:right; display:none; }
  .show-ar .t-ar { display:block; }

  .rep-btn { background:none; border:1px solid var(--border); color:var(--muted); border-radius:7px; width:27px; height:27px; cursor:pointer; display:flex; align-items:center; justify-content:center; }
  .rep-btn.on { border-color:var(--gold); color:var(--gold); background:rgba(255,217,61,.1); }

  .hidden { display:none; }
  @keyframes fadeDown { from{opacity:0;transform:translateY(-18px)} to{opacity:1;transform:translateY(0)} }
  @keyframes fadeUp   { from{opacity:0;transform:translateY(18px)}  to{opacity:1;transform:translateY(0)} }
</style>
</head>
<body>

<div id="google_translate_element"></div>

<div class="wrap">
  <div class="header">
    <div class="badge">ğŸ§ Shadowing Method</div>
    <h1>ØªØ¹Ù„Ù… Ø§Ù„Ø¥Ù†Ø¬Ù„ÙŠØ²ÙŠØ©<br><span>Ø¨Ø§Ù„Ø´Ø§Ø¯ÙˆÙŠÙ†Ø¬</span></h1>
    <p>ØªØ±Ø¬Ù…Ø© ÙÙˆØ±ÙŠØ© Ù…Ù† Ø§Ù„Ø¥Ù†Ø¬Ù„ÙŠØ²ÙŠØ© Ø¥Ù„Ù‰ Ø§Ù„Ø¹Ø±Ø¨ÙŠØ©</p>
    <div class="dedication">
      <span style="color:var(--muted); font-size:0.8rem">Ø¥Ù‡Ø¯Ø§Ø¡ Ù…Ù†</span>
      <strong class="ded-name">Ù….Ø³Ù„Ø·Ø§Ù† Ø¨Ù† Ø¹Ø§ÙŠØ¯</strong>
      <a href="https://sultan-ayed.github.io/my/" target="_blank" class="ded-link">ğŸŒ Ø§Ù„Ù…ÙˆÙ‚Ø¹</a>
    </div>
  </div>

  <div id="setupSection">
    <div class="card">
      <div class="card-head"><span class="card-title">ğŸ“º Ø¥Ø¹Ø¯Ø§Ø¯ Ø§Ù„ÙÙŠØ¯ÙŠÙˆ</span></div>
      <div class="card-body">
        <input type="text" class="url-input" id="videoUrl" placeholder="Ø±Ø§Ø¨Ø· ÙŠÙˆØªÙŠÙˆØ¨ Ù‡Ù†Ø§...">
        <textarea class="tr-input" id="trInput" placeholder="Ø§Ù„ØµÙ‚ Ø§Ù„ØªØ±Ø§Ù†Ø³ÙƒØ±ÙŠØ¨Øª Ù‡Ù†Ø§..."></textarea>
        <div style="margin-top:1.5rem; text-align:left;">
          <button class="btn" onclick="startSession()">Ø§Ø¨Ø¯Ø£ Ø§Ù„ØªØ¯Ø±ÙŠØ¨ â–¶</button>
        </div>
      </div>
    </div>
  </div>

  <div id="playerSection" class="hidden">
    <div class="card">
      <div class="card-head">
        <span class="card-title">ğŸ¬ Ø§Ù„Ù…Ø´ØºÙ„</span>
        <button class="btn-sm" onclick="location.reload()">ÙÙŠØ¯ÙŠÙˆ Ø¬Ø¯ÙŠØ¯</button>
      </div>
      <div class="video-wrap"><div id="ytContainer"></div></div>
      <div class="controls-bar">
        <span style="font-size:0.75rem">Ø§Ù„Ø³Ø±Ø¹Ø©:</span>
        <button class="speed-btn" onclick="setSpeed(0.75,this)">0.75Ã—</button>
        <button class="speed-btn active" onclick="setSpeed(1,this)">1Ã—</button>
        <button class="speed-btn" onclick="setSpeed(1.25,this)">1.25Ã—</button>
      </div>
    </div>

    <div class="card">
      <div class="card-head">
        <span class="card-title">ğŸ“„ Ø§Ù„Ù†Øµ ÙˆØ§Ù„ØªØ±Ø¬Ù…Ø©</span>
        <button class="btn-sm" id="trBtn" onclick="translateToAr()">ğŸŒ ØªØ±Ø¬Ù… Ù„Ù„Ø¹Ø±Ø¨ÙŠØ©</button>
      </div>
      <div class="tr-body" id="trBody"></div>
    </div>
  </div>
</div>

<script type="text/javascript">
// Ø§Ø³ØªØ¯Ø¹Ø§Ø¡ Ù…Ø­Ø±Ùƒ Ø¬ÙˆØ¬Ù„
function googleTranslateElementInit() {
  new google.translate.TranslateElement({
    pageLanguage: 'en', 
    includedLanguages: 'ar', 
    autoDisplay: false
  }, 'google_translate_element');
}
</script>
<script type="text/javascript" src="//translate.google.com/translate_a/element.js?cb=googleTranslateElementInit"></script>

<script>
let player = null;
let lines = [];
let loopIdx = null;
let tracker = null;

function getYTId(url) {
  const m = url.match(/(?:youtube\.com\/(?:watch\?(?:.*&)?v=|shorts\/|embed\/)|youtu\.be\/)([a-zA-Z0-9_-]{11})/);
  return m ? m[1] : null;
}

function parseTranscript(raw) {
  const rows = raw.split('\n').map(r=>r.trim()).filter(Boolean);
  const timeRE = /^(\d{1,2}):(\d{2})(?::(\d{2}))?$/;
  const result = [];
  let i = 0;
  while (i < rows.length) {
    const tm = rows[i].match(timeRE);
    if (tm) {
      const secs = tm[3]!==undefined ? +tm[1]*3600+ +tm[2]*60+ +tm[3] : +tm[1]*60+ +tm[2];
      let parts=[]; i++;
      while (i<rows.length && !rows[i].match(timeRE)) { parts.push(rows[i]); i++; }
      result.push({time:secs, en:parts.join(' ').trim()});
    } else {
      const inl = rows[i].match(/^(\d{1,2}):(\d{2})(?::(\d{2}))?\s+(.+)$/);
      if (inl) {
        const secs = inl[3]!==undefined ? +inl[1]*3600+ +inl[2]*60+ +inl[3] : +inl[1]*60+ +inl[2];
        result.push({time:secs, en:inl[4].trim()});
      }
      i++;
    }
  }
  return result;
}

function startSession() {
  const url = document.getElementById('videoUrl').value;
  const raw = document.getElementById('trInput').value;
  const ytId = getYTId(url);
  if (!ytId || !raw) return alert("Ø§Ù„Ø±Ø¬Ø§Ø¡ Ø¥Ø¯Ø®Ø§Ù„ Ø§Ù„Ø±Ø§Ø¨Ø· ÙˆØ§Ù„Ù†Øµ");
  lines = parseTranscript(raw);
  document.getElementById('setupSection').classList.add('hidden');
  document.getElementById('playerSection').classList.remove('hidden');
  renderLines();
  loadYT(ytId);
}

function loadYT(id) {
  const s = document.createElement('script');
  s.src = "https://www.youtube.com/iframe_api";
  document.head.appendChild(s);
  window.onYouTubeIframeAPIReady = () => {
    player = new YT.Player('ytContainer', {
      videoId: id,
      events: { onReady: () => { startTracker(); } }
    });
  };
}

function startTracker() {
  tracker = setInterval(() => {
    const t = player.getCurrentTime();
    let ai = 0;
    lines.forEach((l, i) => { if (t >= l.time) ai = i; });
    document.querySelectorAll('.t-line').forEach((el, i) => el.classList.toggle('active', i === ai));
    if (loopIdx !== null) {
      const end = lines[loopIdx+1] ? lines[loopIdx+1].time : lines[loopIdx].time + 5;
      if (t >= end) player.seekTo(lines[loopIdx].time);
    }
  }, 400);
}

// ØªØ¹Ø¯ÙŠÙ„ ÙˆØ¸ÙŠÙØ© Ø§Ù„ØªØ±Ø¬Ù…Ø© Ù„ØªØ¹Ù…Ù„ Ø¹Ø¨Ø± Ø¬ÙˆØ¬Ù„
function translateToAr() {
  const btn = document.getElementById('trBtn');
  btn.textContent = "â³ Ø¬Ø§Ø±ÙŠ Ø§Ù„ØªØ±Ø¬Ù…Ø©...";
  
  // ØªÙØ¹ÙŠÙ„ ØªØ±Ø¬Ù…Ø© Ø¬ÙˆØ¬Ù„ Ø¨Ø±Ù…Ø¬ÙŠØ§Ù‹
  const googleCombo = document.querySelector('.goog-te-combo');
  if (googleCombo) {
    googleCombo.value = 'ar';
    googleCombo.dispatchEvent(new Event('change'));
  }

  // Ø¥Ø¸Ù‡Ø§Ø± Ù†ØµÙˆØµ Ø§Ù„ØªØ±Ø¬Ù…Ø© Ø§Ù„Ø¹Ø±Ø¨ÙŠØ© (Ø§Ù„ØªÙŠ Ø³ÙŠÙ‚ÙˆÙ… Ø¬ÙˆØ¬Ù„ Ø¨ØªØ±Ø¬Ù…ØªÙ‡Ø§ Ø¯Ø§Ø®Ù„ Ø§Ù„ØµÙØ­Ø©)
  lines.forEach((line, i) => {
    const arEl = document.getElementById(`ar-${i}`);
    if (arEl) {
      arEl.textContent = line.en; // Ù†Ø¶Ø¹ Ø§Ù„Ù†Øµ Ø§Ù„Ø¥Ù†Ø¬Ù„ÙŠØ²ÙŠ ÙˆØ¬ÙˆØ¬Ù„ Ø³ÙŠØ­ÙˆÙ„Ù‡ Ù„Ø¹Ø±Ø¨ÙŠ
    }
  });

  document.getElementById('trBody').classList.add('show-ar');
  setTimeout(() => { btn.textContent = "âœ“ ØªÙ…Øª Ø§Ù„ØªØ±Ø¬Ù…Ø©"; }, 2000);
}

function renderLines() {
  const body = document.getElementById('trBody');
  body.innerHTML = lines.map((l, i) => `
    <div class="t-line" onclick="player.seekTo(${l.time})">
      <span class="t-time">${Math.floor(l.time/60)}:${Math.floor(l.time%60).toString().padStart(2,'0')}</span>
      <div style="flex:1">
        <div class="t-en">${l.en}</div>
        <div class="t-ar" id="ar-${i}"></div>
      </div>
      <button class="rep-btn" onclick="event.stopPropagation(); loopIdx=(loopIdx===${i}?null:${i}); this.classList.toggle('on')">ğŸ”</button>
    </div>
  `).join('');
}

function setSpeed(s, btn) {
  player.setPlaybackRate(s);
  document.querySelectorAll('.speed-btn').forEach(b=>b.classList.remove('active'));
  btn.classList.add('active');
}
</script>
</body>
</html>
